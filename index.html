<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Digital Impact | Tracker</title>
    
    <meta name="theme-color" content="#0B1026">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Digital Impact">
    <meta name="application-name" content="Digital Impact">
    
    <link rel="manifest" href="manifest.json?v=5">
    
    <link rel="icon" type="image/png" href="192.png">
    <link rel="apple-touch-icon" href="512.png">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('Service Worker registered!'))
                    .catch(err => console.log('Service Worker failed:', err));
            });
        }
    </script>

    <style>
        /* --- ANIMATIONS & SCROLLBAR --- */
        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0); opacity: 1; }
            100% { transform: translateY(110vh) translateX(20px); opacity: 0.3; }
        }
        .animate-fall {
            animation: fall linear infinite;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.2s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Custom Scrollbar */
        .ice-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .ice-scroll::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }
        .ice-scroll::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }
        
        /* Input Font Fix */
        input, button, select, textarea {
            font-size: 16px; 
        }
    </style>
</head>
<body class="bg-[#0B1026] text-slate-900 font-sans selection:bg-cyan-200 selection:text-cyan-900 overflow-x-hidden">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Data ---
        // Water Rates (Liters)
        const WATER_ACTIVITIES = [
            { id: 'ai', universalId: 'ai_chat', label: 'AI Chat (LLMs)', rate: 0.042, icon: 'ph-robot', desc: 'Heavy compute cooling', unit: 'queries' },
            { id: 'aigen', universalId: 'ai_image', label: 'AI Image', rate: 15.042, icon: 'ph-image', desc: 'Can be anywhere between 2-50L', unit: 'images' },
            { id: 'video_hd', universalId: 'streaming', label: 'Streaming (4K/HD)', rate: 0.75, icon: 'ph-film-strip', desc: 'High bandwidth server load', unit: 'min' },
            { id: 'game', universalId: 'gaming', label: 'Online Gaming', rate: 0.00018, icon: 'ph-game-controller', desc: 'Very little on the server', unit: 'min' },
            { id: 'social', universalId: 'social', label: 'Tiktok', rate: 0.270, icon: 'ph-thumbs-up', desc: 'Standard server requests', unit: 'min' },
            { id: 'Longersocials', label: 'Youtube Longforms', rate: 1.600, icon: 'ph-monitor-play', desc: '(20 mins)', unit: 'videos' },
            { id: 'Twitch', label: 'Twitch Streams', rate: 8.000, icon: 'ph-broadcast', desc: '(1h 30 mins)', unit: 'streams' },
            { id: 'music', label: 'Music Streaming', rate: 0.100, icon: 'ph-music-notes', desc: 'Lower bandwidth', unit: 'min' },
            { id: 'browsing', universalId: 'search', label: 'Google Searches', rate: 0.00026, icon: 'ph-globe', desc: 'Light server load', unit: 'searches' },
            { id: 'cleaning', label: 'Showering', rate: 12.0000, icon: 'ph-drop', desc: "Showers shouldn't take more than 10 mins", unit: 'min', isExtra: true },
            { id: 'flush', label: 'Toilet Flushes', rate: 9.5000, icon: 'ph-drop', desc: "Only Flush When You Need To", unit: 'amount', isExtra: true },
            { id: 'bath', label: 'Bath', rate: 95.5000, icon: 'ph-bathtub', desc: "Only Flush When You Need To", unit: 'amount', isExtra: true },
        ];

        // CO2 Rates (Grams)
        // UPDATED: Driving Car is now in Meters (0.17g per meter)
        const CO2_ACTIVITIES = [
            { id: 'co2_ai', universalId: 'ai_chat', label: 'AI Chat (LLMs)', rate: 2.0, icon: 'ph-robot', desc: 'Training + Inference', unit: 'queries' },
            { id: 'co2_stream', universalId: 'streaming', label: 'Streaming (HD)', rate: 0.93, icon: 'ph-film-strip', desc: '~56g per hour', unit: 'min' },
            { id: 'co2_game', universalId: 'gaming', label: 'Online Gaming', rate: 3.33, icon: 'ph-game-controller', desc: '~200g per hour', unit: 'min' },
            { id: 'co2_social', universalId: 'social', label: 'Social Media', rate: 2.0, icon: 'ph-thumbs-up', desc: '~120g per hour', unit: 'min' },
            { id: 'co2_search', universalId: 'search', label: 'Google Search', rate: 0.2, icon: 'ph-globe', desc: '0.2g per search', unit: 'searches' },
            { id: 'co2_email', label: 'Sent Emails', rate: 4.0, icon: 'ph-envelope', desc: 'Standard email', unit: 'emails' },
            { id: 'co2_drive', label: 'Driving Car', rate: 0.17, icon: 'ph-car', desc: 'Avg gas car per meter', unit: 'm', isExtra: true },
            { id: 'co2_kettle', label: 'Boiling Kettle', rate: 15.0, icon: 'ph-coffee', desc: 'Electric kettle boil', unit: 'boils', isExtra: true },
        ];

        const App = () => {
            // --- State ---
            const [entries, setEntries] = useState(() => {
                const saved = localStorage.getItem('digitalThawEntries');
                const parsed = saved ? JSON.parse(saved) : [];
                return parsed.map(e => ({ ...e, type: e.type || 'water' }));
            });

            const [mode, setMode] = useState('water');
            const [selectedActivity, setSelectedActivity] = useState(WATER_ACTIVITIES[0].id);
            const [inputValue, setInputValue] = useState('');
            const [showExtras, setShowExtras] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [historyViewDay, setHistoryViewDay] = useState(null); 
            const [unitSystem, setUnitSystem] = useState('metric');
            const [universalMode, setUniversalMode] = useState(true);
            const [installPrompt, setInstallPrompt] = useState(null);

            // --- Computed ---
            const currentActivityList = useMemo(() => {
                return mode === 'water' ? WATER_ACTIVITIES : CO2_ACTIVITIES;
            }, [mode]);

            const theme = useMemo(() => {
                return mode === 'water' 
                    ? {
                        bg: 'from-[#0B1026] via-[#2B32B2] to-[#E3FDFD]',
                        accent: 'cyan',
                        text: 'text-cyan-400',
                        btn: 'from-cyan-400 to-blue-500 hover:from-cyan-300 hover:to-blue-400',
                        activeBtn: 'bg-blue-500/30 border-blue-300 shadow-[0_0_15px_rgba(59,130,246,0.5)]',
                        toggleOn: 'bg-blue-500',
                        iconColor: 'text-cyan-400',
                        barColor: 'bg-cyan-400',
                        barBase: 'bg-cyan-900/50'
                      }
                    : {
                        bg: 'from-[#1a1a1a] via-[#434343] to-[#889d9d]',
                        accent: 'gray',
                        text: 'text-gray-300',
                        btn: 'from-gray-500 to-slate-600 hover:from-gray-400 hover:to-slate-500',
                        activeBtn: 'bg-gray-500/30 border-gray-300 shadow-[0_0_15px_rgba(156,163,175,0.5)]',
                        toggleOn: 'bg-gray-500',
                        iconColor: 'text-gray-400',
                        barColor: 'bg-gray-400',
                        barBase: 'bg-gray-700/50'
                      }
            }, [mode]);

            useEffect(() => {
                setSelectedActivity(currentActivityList[0].id);
                setInputValue('');
            }, [mode, currentActivityList]);

            const modeEntries = useMemo(() => {
                return entries.filter(e => e.type === mode);
            }, [entries, mode]);

            const totalImpact = useMemo(() => {
                return modeEntries.reduce((acc, entry) => acc + entry.impact, 0);
            }, [modeEntries]);

            useEffect(() => {
                localStorage.setItem('digitalThawEntries', JSON.stringify(entries));
            }, [entries]);

            useEffect(() => {
                const handler = (e) => {
                    e.preventDefault();
                    setInstallPrompt(e);
                };
                window.addEventListener('beforeinstallprompt', handler);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);

            const getDisplayValues = (val, type = mode) => {
                if (type === 'water') {
                    if (unitSystem === 'imperial') {
                        return { val: (val * 0.264172).toFixed(2), unit: 'gal' };
                    }
                    return { val: val.toFixed(2), unit: 'L' };
                } else {
                    if (unitSystem === 'imperial') {
                        const oz = val * 0.035274;
                        if (oz > 16) {
                            return { val: (oz / 16).toFixed(2), unit: 'lbs' };
                        }
                        return { val: oz.toFixed(1), unit: 'oz' };
                    }
                    if (val >= 1000) {
                        return { val: (val / 1000).toFixed(2), unit: 'kg' };
                    }
                    return { val: val.toFixed(1), unit: 'g' };
                }
            };

            const handleAdd = (e) => {
                e.preventDefault();
                if (!inputValue || inputValue <= 0) return;

                const amount = parseFloat(inputValue);
                const newEntries = [];

                const activity = currentActivityList.find(a => a.id === selectedActivity);
                const impact = amount * activity.rate;
                
                newEntries.push({
                    id: Date.now(),
                    type: mode,
                    activity: activity.label,
                    icon: activity.icon,
                    amount: amount,
                    unit: activity.unit,
                    impact: impact 
                });

                if (universalMode && activity.universalId) {
                    const targetMode = mode === 'water' ? 'co2' : 'water';
                    const targetList = mode === 'water' ? CO2_ACTIVITIES : WATER_ACTIVITIES;
                    const partnerActivity = targetList.find(a => a.universalId === activity.universalId);

                    if (partnerActivity) {
                        newEntries.push({
                            id: Date.now() + 1,
                            type: targetMode,
                            activity: partnerActivity.label,
                            icon: partnerActivity.icon,
                            amount: amount,
                            unit: partnerActivity.unit,
                            impact: amount * partnerActivity.rate
                        });
                    }
                }

                setEntries([...newEntries, ...entries]);
                setInputValue('');
            };

            const removeEntry = (id) => {
                setEntries(entries.filter(e => e.id !== id));
            };

            const handleResetData = () => {
                if(confirm("Are you sure you want to wipe all history?")) {
                    setEntries([]); 
                    localStorage.removeItem('digitalThawEntries');
                    setShowSettings(false);
                }
            };

            const handleDownload = () => {
                if (installPrompt) {
                    installPrompt.prompt();
                    installPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            setInstallPrompt(null);
                        }
                    });
                } else {
                    const isLocal = window.location.protocol === 'file:';
                    if (isLocal) {
                         alert("⚠️ To install this app, please upload these files to a web server.");
                    } else {
                         alert("Tap your browser's 'Share' or 'Menu' button and select 'Add to Home Screen'.");
                    }
                }
            };

            const historyStats = useMemo(() => {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const dayOfWeek = today.getDay();
                
                const startOfThisWeek = new Date(today);
                startOfThisWeek.setDate(today.getDate() - dayOfWeek);
                startOfThisWeek.setHours(0,0,0,0);

                const startOfLastWeek = new Date(startOfThisWeek);
                startOfLastWeek.setDate(startOfThisWeek.getDate() - 7);
                
                let thisWeekTotal = 0;
                let lastWeekTotal = 0;
                const dailyTotals = [0, 0, 0, 0, 0, 0, 0];

                modeEntries.forEach(entry => {
                    const entryDate = new Date(entry.id);
                    const compareDate = new Date(entryDate.getFullYear(), entryDate.getMonth(), entryDate.getDate());

                    if (compareDate >= startOfThisWeek) {
                        thisWeekTotal += entry.impact;
                        dailyTotals[entryDate.getDay()] += entry.impact;
                    } else if (compareDate >= startOfLastWeek && compareDate < startOfThisWeek) {
                        lastWeekTotal += entry.impact;
                    }
                });

                return { thisWeekTotal, lastWeekTotal, dailyTotals };
            }, [modeEntries]);

            const selectedDayEntries = useMemo(() => {
                if (historyViewDay === null) return [];
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const dayOfWeek = today.getDay(); 
                const startOfThisWeek = new Date(today);
                startOfThisWeek.setDate(today.getDate() - dayOfWeek);
                startOfThisWeek.setHours(0,0,0,0);
                
                const targetDate = new Date(startOfThisWeek);
                targetDate.setDate(startOfThisWeek.getDate() + historyViewDay);
                
                return modeEntries.filter(entry => {
                    const entryDate = new Date(entry.id);
                    return entryDate.getDate() === targetDate.getDate() &&
                           entryDate.getMonth() === targetDate.getMonth() &&
                           entryDate.getFullYear() === targetDate.getFullYear();
                }).sort((a, b) => b.id - a.id);
            }, [historyViewDay, modeEntries]);

            const [snowflakes, setSnowflakes] = useState([]);
            useEffect(() => {
                const flakes = Array.from({ length: 20 }).map((_, i) => ({
                    id: i,
                    left: `${Math.random() * 100}%`,
                    width: `${Math.random() * 5 + 3}px`,
                    height: `${Math.random() * 5 + 3}px`,
                    animationDuration: `${Math.random() * 10 + 5}s`,
                    animationDelay: `${Math.random() * 5}s`
                }));
                setSnowflakes(flakes);
            }, []);

            const ActivityButton = ({ type }) => (
                <button
                    key={type.id}
                    type="button"
                    onClick={() => setSelectedActivity(type.id)}
                    className={`flex items-center gap-2 rounded-xl border p-3 text-left transition-all duration-200 active:scale-95 ${
                        selectedActivity === type.id
                        ? theme.activeBtn
                        : 'bg-white/5 border-transparent hover:bg-white/10'
                    }`}
                >
                    <i className={`text-xl text-white ${type.icon}`}></i>
                    <span className="text-xs font-semibold text-white leading-tight">{type.label}</span>
                </button>
            );

            const mainActivities = currentActivityList.filter(type => !type.isExtra);
            const extraActivities = currentActivityList.filter(type => type.isExtra);
            const currentActivity = currentActivityList.find(a => a.id === selectedActivity) || mainActivities[0];
            const currentTotalDisplay = getDisplayValues(totalImpact);

            return (
                <div className="relative min-h-screen w-full">
                    <div className="fixed inset-0 z-0">
                        <div className={`absolute inset-0 bg-gradient-to-b transition-colors duration-1000 ${theme.bg}`}></div>
                        {snowflakes.map((flake) => (
                            <div
                                key={flake.id}
                                className="absolute bg-white rounded-full opacity-80 pointer-events-none animate-fall"
                                style={{
                                    top: '-10px',
                                    left: flake.left,
                                    width: flake.width,
                                    height: flake.height,
                                    animationDuration: flake.animationDuration,
                                    animationDelay: flake.animationDelay
                                }}
                            ></div>
                        ))}
                    </div>

                    {showHistory && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in" onClick={() => setShowHistory(false)}>
                            <div className="bg-[#1a2342] border border-white/20 w-full max-w-md rounded-2xl p-6 shadow-2xl overflow-y-auto max-h-[90vh]" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold text-white flex items-center gap-2">
                                        <i className={`ph-fill ph-clock-counter-clockwise ${theme.iconColor}`}></i> History
                                    </h2>
                                    <button onClick={() => setShowHistory(false)} className="text-blue-200 hover:text-white transition-colors">
                                        <i className="ph-bold ph-x text-xl"></i>
                                    </button>
                                </div>

                                <div className="grid grid-cols-2 gap-4 mb-6">
                                    {['This Week', 'Last Week'].map((label, idx) => {
                                        const val = idx === 0 ? historyStats.thisWeekTotal : historyStats.lastWeekTotal;
                                        const fmt = getDisplayValues(val);
                                        const boxClass = idx === 0 
                                            ? (mode === 'water' ? 'bg-blue-500/20 border-blue-400/30' : 'bg-gray-500/20 border-gray-400/30')
                                            : 'bg-white/5 border-white/10';
                                        
                                        return (
                                            <div key={label} className={`${boxClass} rounded-xl p-4 text-center border`}>
                                                <div className="text-xs text-blue-200 uppercase tracking-wider mb-1">{label}</div>
                                                <div className="text-2xl font-bold text-white">{fmt.val} <span className="text-sm font-normal">{fmt.unit}</span></div>
                                            </div>
                                        )
                                    })}
                                </div>

                                <div className="bg-white/5 rounded-xl p-4 border border-white/10">
                                    <h3 className="text-sm text-blue-200 mb-4 font-semibold">Weekly Breakdown</h3>
                                    <div className="flex items-end justify-between h-32 gap-2">
                                        {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day, index) => {
                                            const val = historyStats.dailyTotals[index];
                                            const scaleMin = mode === 'water' ? 200 : 2000;
                                            const max = Math.max(...historyStats.dailyTotals, scaleMin); 
                                            const height = (val / max) * 100;
                                            const fmt = getDisplayValues(val);
                                            
                                            return (
                                                <div 
                                                    key={day} 
                                                    onClick={() => setHistoryViewDay(index)}
                                                    className={`flex flex-col items-center flex-1 h-full justify-end group cursor-pointer p-1 rounded-lg transition-colors ${historyViewDay === index ? 'bg-white/10' : 'hover:bg-white/5'}`}
                                                >
                                                    <div className={`w-full rounded-t-sm relative transition-all duration-500 ${historyViewDay === index ? theme.barColor : theme.barBase}`} style={{height: `${Math.max(height, 5)}%`}}>
                                                        <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-20">
                                                            {fmt.val} {fmt.unit}
                                                        </div>
                                                    </div>
                                                    <div className={`text-[10px] mt-2 font-medium ${historyViewDay === index ? 'text-white' : 'text-blue-300'}`}>{day}</div>
                                                </div>
                                            )
                                        })}
                                    </div>

                                    {historyViewDay !== null && (
                                        <div className="mt-4 pt-4 border-t border-white/10 animate-fade-in">
                                            <h4 className="text-blue-200 text-xs uppercase tracking-wider font-bold mb-3">
                                                {['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][historyViewDay]} Details
                                            </h4>
                                            <div className="space-y-2 max-h-40 overflow-y-auto pr-1 ice-scroll">
                                                {selectedDayEntries.length === 0 ? (
                                                    <div className="text-center text-blue-300/40 text-xs italic py-2">No activity recorded</div>
                                                ) : (
                                                    selectedDayEntries.map(entry => {
                                                        const f = getDisplayValues(entry.impact);
                                                        return (
                                                            <div key={entry.id} className="flex justify-between items-center bg-black/20 p-2 rounded text-xs border border-white/5">
                                                                <div className="flex items-center gap-2">
                                                                    <div className={`w-6 h-6 rounded-full flex items-center justify-center ${mode === 'water' ? 'bg-blue-500/20' : 'bg-gray-500/20'}`}>
                                                                        <i className={`ph-fill ${entry.icon} ${theme.iconColor}`}></i>
                                                                    </div>
                                                                    <span className="text-white">{entry.activity}</span>
                                                                </div>
                                                                <div className="text-right">
                                                                    <div className={`font-bold ${theme.text}`}>{f.val} {f.unit}</div>
                                                                    <div className="text-[10px] text-blue-300/50">{entry.amount} {entry.unit}</div>
                                                                </div>
                                                            </div>
                                                        )
                                                    })
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in" onClick={() => setShowSettings(false)}>
                            <div className="bg-[#1a2342] border border-white/20 w-full max-w-sm rounded-2xl p-6 shadow-2xl" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold text-white">Settings</h2>
                                    <button onClick={() => setShowSettings(false)} className="text-blue-200 hover:text-white transition-colors">
                                        <i className="ph-bold ph-x text-xl"></i>
                                    </button>
                                </div>

                                <div className="space-y-4">
                                    <div className="bg-white/5 p-4 rounded-xl flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <i className={`ph-fill ${mode === 'water' ? 'ph-drop text-cyan-400' : 'ph-cloud text-gray-400'} text-xl`}></i>
                                            <span className="text-white font-medium">Tracker</span>
                                        </div>
                                        <div className="flex bg-black/30 rounded-lg p-1">
                                            <button 
                                                onClick={() => setMode('water')}
                                                className={`px-3 py-1 rounded-md text-sm font-bold transition-all ${mode === 'water' ? 'bg-blue-500 text-white shadow-lg' : 'text-blue-200 hover:text-white'}`}
                                            >
                                                Water
                                            </button>
                                            <button 
                                                onClick={() => setMode('co2')}
                                                className={`px-3 py-1 rounded-md text-sm font-bold transition-all ${mode === 'co2' ? 'bg-gray-500 text-white shadow-lg' : 'text-blue-200 hover:text-white'}`}
                                            >
                                                CO2
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-white/5 p-4 rounded-xl flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <i className={`ph-fill ph-arrows-left-right ${theme.iconColor} text-xl`}></i>
                                            <div className="flex flex-col">
                                                <span className="text-white font-medium text-sm">Universal Measurements</span>
                                                <span className="text-[10px] text-blue-300/50">Auto-add to both lists</span>
                                            </div>
                                        </div>
                                        <button 
                                            onClick={() => setUniversalMode(!universalMode)}
                                            className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${universalMode ? theme.toggleOn : 'bg-white/10'}`}
                                        >
                                            <div className={`w-4 h-4 bg-white rounded-full shadow-sm transition-transform duration-300 ${universalMode ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                        </button>
                                    </div>

                                    <div className="bg-white/5 p-4 rounded-xl flex justify-between items-center">
                                        <div className="flex items-center gap-3">
                                            <i className={`ph-fill ph-ruler ${theme.iconColor} text-xl`}></i>
                                            <span className="text-white font-medium">System</span>
                                        </div>
                                        <div className="flex bg-black/30 rounded-lg p-1">
                                            <button 
                                                onClick={() => setUnitSystem('metric')}
                                                className={`px-3 py-1 rounded-md text-sm font-bold transition-all ${unitSystem === 'metric' ? theme.toggleOn + ' text-white shadow-lg' : 'text-blue-200 hover:text-white'}`}
                                            >
                                                Metric
                                            </button>
                                            <button 
                                                onClick={() => setUnitSystem('imperial')}
                                                className={`px-3 py-1 rounded-md text-sm font-bold transition-all ${unitSystem === 'imperial' ? theme.toggleOn + ' text-white shadow-lg' : 'text-blue-200 hover:text-white'}`}
                                            >
                                                Imperial
                                            </button>
                                        </div>
                                    </div>

                                    <button 
                                        onClick={handleResetData}
                                        className="w-full bg-white/5 hover:bg-red-500/20 hover:border-red-500/50 border border-transparent p-4 rounded-xl flex items-center gap-3 transition-all group"
                                    >
                                        <div className="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center group-hover:bg-red-500 text-white">
                                            <i className="ph-bold ph-trash"></i>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-white font-medium group-hover:text-red-200">Reset Data</div>
                                            <div className="text-xs text-blue-300/50 group-hover:text-red-300/70">Wipe all history</div>
                                        </div>
                                    </button>

                                    <button 
                                        onClick={handleDownload}
                                        className="w-full bg-gradient-to-r from-cyan-900/50 to-blue-900/50 hover:from-cyan-800 hover:to-blue-800 border border-cyan-500/30 p-4 rounded-xl flex items-center gap-3 transition-all"
                                    >
                                        <div className="w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center text-cyan-300">
                                            <i className="ph-bold ph-download-simple"></i>
                                        </div>
                                        <div className="text-left">
                                            <div className="text-white font-medium">Download App</div>
                                            <div className="text-xs text-blue-300/50">Add to Home Screen</div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="relative z-10 flex min-h-screen items-center justify-center p-4 md:p-6 overflow-y-auto">
                        <div className="w-full max-w-4xl overflow-hidden rounded-3xl bg-white/10 shadow-2xl backdrop-blur-xl border border-white/20 flex flex-col md:flex-row ring-1 ring-white/30 my-4 md:my-0">
                        
                            <div className="relative flex flex-col justify-center border-b border-white/20 p-6 md:p-8 md:w-1/2 md:border-b-0 md:border-r bg-white/5 md:bg-transparent">
                                
                                <div className="absolute top-6 right-6 flex gap-2 z-20">
                                    <button 
                                        onClick={() => setShowHistory(true)}
                                        className="p-2 rounded-full bg-white/5 hover:bg-white/10 text-cyan-200 hover:text-white transition-all border border-transparent hover:border-cyan-400/30"
                                        title="History"
                                    >
                                        <i className="ph-fill ph-clock-counter-clockwise text-xl"></i>
                                    </button>
                                    <button 
                                        onClick={() => setShowSettings(true)}
                                        className="p-2 rounded-full bg-white/5 hover:bg-white/10 text-blue-200 hover:text-white transition-all border border-transparent hover:border-white/20"
                                        title="Settings"
                                    >
                                        <i className="ph-fill ph-gear text-xl"></i>
                                    </button>
                                </div>

                                <h1 className="mb-2 text-3xl md:text-4xl font-bold tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-white to-blue-200 drop-shadow-sm pr-20">
                                    Digital Impact
                                </h1>
                                <p className="mb-6 md:mb-8 text-sm font-light text-blue-100 leading-relaxed">
                                    {mode === 'water' 
                                        ? 'Data centers drink water to stay cool. Check your daily digital water footprint.'
                                        : 'Every click burns energy. Check your daily carbon footprint from digital activities.'}
                                </p>

                                <form onSubmit={handleAdd} className="space-y-4 md:space-y-5">
                                    <div>
                                        <div className="flex justify-between items-end mb-2">
                                            <label className="block text-sm font-medium text-blue-200">Activity Type</label>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-2 transition-all duration-300">
                                            {mainActivities.map(type => <ActivityButton key={type.id} type={type} />)}
                                            {showExtras && extraActivities.map(type => <ActivityButton key={type.id} type={type} />)}
                                        </div>

                                        <button 
                                            type="button" 
                                            onClick={() => setShowExtras(!showExtras)}
                                            className={`mt-3 text-xs font-bold hover:text-white flex items-center gap-1 transition-colors ml-1 ${mode === 'water' ? 'text-cyan-300' : 'text-gray-300'}`}
                                        >
                                            {showExtras ? (
                                                <><i className="ph-bold ph-caret-up"></i> Show Less</>
                                            ) : (
                                                <><i className="ph-bold ph-caret-down"></i> Show More Options</>
                                            )}
                                        </button>
                                    </div>

                                    <div>
                                        <label className="mb-2 block text-sm font-medium text-blue-200">
                                            {currentActivity.unit === 'min' ? 'Duration (Minutes)' : (currentActivity.unit === 'm' ? 'Distance (Meters)' : 'Quantity (Amount)')}
                                        </label>
                                        <div className="relative">
                                            <input
                                                type="number"
                                                min="1"
                                                inputMode="numeric" 
                                                value={inputValue}
                                                onChange={(e) => setInputValue(e.target.value)}
                                                placeholder={currentActivity.unit === 'min' ? "e.g. 60" : "e.g. 10"}
                                                className={`w-full rounded-xl border border-white/20 bg-white/10 p-4 text-base text-white placeholder-blue-300/50 transition-all focus:outline-none focus:ring-1 appearance-none ${mode === 'water' ? 'focus:border-blue-300 focus:ring-blue-300' : 'focus:border-gray-300 focus:ring-gray-300'}`}
                                            />
                                            <span className="absolute right-4 top-4 font-bold text-blue-200 uppercase text-xs tracking-wider pt-1">
                                                {currentActivity.unit}
                                            </span>
                                        </div>
                                    </div>

                                    <button
                                        type="submit"
                                        className={`w-full rounded-xl bg-gradient-to-r py-4 font-bold text-slate-900 shadow-lg transition-transform hover:-translate-y-1 active:translate-y-0 active:scale-95 ${theme.btn}`}
                                    >
                                        Add to Impact
                                    </button>
                                </form>
                            </div>

                            <div className="flex flex-col bg-black/20 p-6 md:p-8 md:w-1/2 min-h-[400px] md:min-h-auto">
                                <div className="group relative mb-6 overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-6 text-center">
                                    <div className={`absolute left-0 top-0 h-1 w-full bg-gradient-to-r from-transparent to-transparent opacity-50 ${mode === 'water' ? 'via-cyan-400' : 'via-gray-400'}`}></div>
                                    <h2 className="mb-1 text-xs md:text-sm uppercase tracking-widest text-blue-200">Total {mode === 'water' ? 'Water' : 'CO2'} Estimate</h2>
                                    <div className="mb-2 text-4xl md:text-5xl font-bold text-white drop-shadow-[0_0_15px_rgba(100,200,255,0.4)]">
                                        {currentTotalDisplay.val} <span className="text-xl md:text-2xl text-blue-300">{currentTotalDisplay.unit}</span>
                                    </div>
                                    
                                    <div className="flex items-center justify-center gap-2 text-sm text-blue-200">
                                        {mode === 'water' ? (
                                            <>
                                                <i className="ph-fill ph-drop text-cyan-400"></i>
                                                <span>≈ {Math.ceil(totalImpact * 2)} bottles (500ml)</span>
                                            </>
                                        ) : (
                                            <>
                                                <i className="ph-fill ph-balloon text-gray-400"></i>
                                                <span>≈ {Math.ceil(totalImpact / 18)} balloons</span>
                                            </>
                                        )}
                                    </div>
                                </div>

                                <h3 className="mb-4 border-b border-white/10 pb-2 text-sm font-semibold text-blue-200">Today's Usage Log</h3>

                                <div className="ice-scroll flex-1 space-y-3 overflow-y-auto pr-2" style={{ maxHeight: '300px' }}>
                                    {modeEntries.length === 0 ? (
                                        <div className="flex h-full flex-col items-center justify-center text-blue-300/50 italic py-8">
                                            <i className={`ph ${mode === 'water' ? 'ph-snowflake' : 'ph-cloud'} mb-2 text-4xl animate-spin`} style={{ animationDuration: '10s' }}></i>
                                            <p>No activity recorded yet.</p>
                                        </div>
                                    ) : (
                                        modeEntries.map((entry) => {
                                            const f = getDisplayValues(entry.impact);
                                            return (
                                                <div
                                                    key={entry.id}
                                                    className="group flex items-center justify-between rounded-xl border border-white/5 bg-white/5 p-3 md:p-4 transition-colors hover:bg-white/10"
                                                >
                                                    <div className="flex items-center gap-3">
                                                        <div className={`flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-cyan-300 ${mode === 'water' ? 'bg-blue-500/20' : 'bg-gray-500/20'}`}>
                                                            <i className={`text-xl ${entry.icon} ${theme.iconColor}`}></i>
                                                        </div>
                                                        <div className="overflow-hidden">
                                                            <div className="font-semibold text-white truncate">{entry.activity}</div>
                                                            <div className="text-xs text-blue-200">
                                                                {entry.amount} {entry.unit}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="flex items-center gap-3 md:gap-4 shrink-0">
                                                        <div className="text-right">
                                                            <div className={`font-bold ${theme.text}`}>
                                                                {f.val} {f.unit}
                                                            </div>
                                                        </div>
                                                        <button
                                                            onClick={() => removeEntry(entry.id)}
                                                            className="flex h-8 w-8 items-center justify-center rounded-full text-white/50 hover:bg-red-500/20 hover:text-red-400 md:opacity-0 md:group-hover:opacity-100 transition-all"
                                                            aria-label="Remove entry"
                                                        >
                                                            <i className="ph-bold ph-x"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            )
                                        })
                                    )}
                                </div>

                                <div className="mt-6 text-center text-[10px] text-blue-300/40">
                                    *Estimates based on approximate Data Center {mode === 'water' ? 'Water Usage Effectiveness (WUE)' : 'Carbon Intensity'} metrics.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>